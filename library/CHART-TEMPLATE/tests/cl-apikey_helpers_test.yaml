suite: test API Key helpers
templates:
  - templates/example-cm-apikey.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: creates secret names for local API Key
    set:
      apikey: local
    asserts:
      - equal:
          path: data.apikey-secret-name
          value: my-release-CHART-TEMPLATE-apikey
      - equal:
          path: data.apikey-secret-key-name
          value: apiKey
  - it: creates secret names for global API Key
    set:
      global:
        apiKey: local
    asserts:
      - equal:
          path: data.apikey-secret-name
          value: my-release-CHART-TEMPLATE-apikey
      - equal:
          path: data.apikey-secret-key-name
          value: apiKey

  - it: returns local custom secret names
    set:
      customAPIKeySecretName: local
      customAPIKeySecretKey: localkey
    asserts:
      - equal:
          path: data.apikey-secret-name
          value: local
      - equal:
          path: data.apikey-secret-key-name
          value: localkey
  - it: returns global custom secret names
    set:
      global:
        customAPIKeySecretName: global
        customAPIKeySecretKey: globalkey
    asserts:
      - equal:
          path: data.apikey-secret-name
          value: global
      - equal:
          path: data.apikey-secret-key-name
          value: globalkey
  - it: local secret names override global secret names
    set:
      customAPIKeySecretName: local
      customAPIKeySecretKey: localkey
      global:
        customAPIKeySecretName: global
        customAPIKeySecretKey: globalkey
    asserts:
      - equal:
          path: data.apikey-secret-name
          value: local
      - equal:
          path: data.apikey-secret-key-name
          value: localkey
