suite: test cluster helper
templates:
  - templates/deployment.yaml
release:
  name: my-release
  namespace: my-namespace

# The name of the cluster is mandatory, to not make all the tests fail because they have no license
# and not having to add license to all the tests I have added it to the `values.yaml`.
# This change makes this tests a bit funky because we have to manually set local cluster to null
#constantly to overwrite it.

tests:
  - it: helper works (and fails) when global is null and no local cluster value
    set:
      global: null
      cluster: null
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[0].value
          value: null

  - it: sets local cluster as cluster name even if global is set
    set:
      cluster: test-cluster
      global:
        cluster: global-cluster
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[0].value
          value: test-cluster

  - it: sets global cluster as name if only global is set
    set:
      global:
        cluster: global-cluster
      cluster: null
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[0].value
          value: global-cluster
