suite: test service accounts creation
templates:
  - templates/serviceaccount.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: default values should not template a service account
asserts:
  - hasDocuments:
  count: 0

  - it: create (globally) a service account creates a service account with the chart name
set:
  global:
serviceAccount:
  create: true
asserts:
  - hasDocuments:
  count: 1
  - equal:
  path: metadata.name
  value: nri-my-release-CHART-TEMPLATE

  - it: create (locally) a service account creates a service account with the chart name
set:
  serviceAccount:
create: true
asserts:
  - hasDocuments:
  count: 1
  - equal:
  path: metadata.name
  value: nri-my-release-CHART-TEMPLATE

  - it: Allow to override the global creation of a service account
set:
  global:
serviceAccount:
  create: true
  serviceAccount:
create: false
asserts:
  - hasDocuments:
  count: 0
