suite: test labels helpers
templates:
  - templates/deployment.yaml # we could check the same for service and serviceAccount as well
release:
  name: my-release
  namespace: my-namespace
set:
  licenseKey: test-license-key
  cluster: test-cluster
tests:
  - it: does not fail if globals=nil
    set:
      global: null
    asserts:
      - hasDocuments:
          count: 1
  - it: sets labels according to values
    set:
      labels:
        helm.sh/chart: fixed
    asserts:
      - equal:
          path: metadata.labels
          value:
            app.kubernetes.io/instance: my-release
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: CHART-TEMPLATE
            app.kubernetes.io/version: 1.16.0
            helm.sh/chart: fixed   # We cannot test behaviour without overwriting this since the version chart often changes
  - it: sets labels with globals giving priority to values
    set:
      labels:
        helm.sh/chart: fixed
        one: overwriting
      global:
        labels:
          one: overwritten
          two: second
    asserts:
      - equal:
          path: metadata.labels
          value:
            app.kubernetes.io/instance: my-release
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: CHART-TEMPLATE
            app.kubernetes.io/version: 1.16.0
            helm.sh/chart: fixed
            one: overwriting
            two: second
