suite: test configmap
templates:
  - templates/agent-configmap.yaml
tests:
  - it: agent configMap is created and configured from config
    set:
      licenseKey: test
      cluster: test
      config:
        test1: one
        test2: two
    asserts:
      - equal:
          path: data.newrelic-infra\.yml
          value: |-
            test1: one
            test2: two
  - it: agent configMap is created and configured from common.agentConfig
    set:
      licenseKey: test
      cluster: test
      common.agentConfig:
        test1: one
        test2: two
    asserts:
      - equal:
          path: data.newrelic-infra\.yml
          value: |-
            test1: one
            test2: two
  - it: common.agentConfig takes precedence
    set:
      licenseKey: test
      cluster: test
      common.agentConfig:
        test1: one
      config:
        test2: two
    asserts:
      - equal:
          path: data.newrelic-infra\.yml
          value: |-
            test1: one
