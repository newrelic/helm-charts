Your deployment of the New Relic Infrastructure agent is complete if you have not used --wait during the installation of this helm chart. You can check on the progress of this by running the following command:

    kubectl get daemonset -o wide -w --namespace {{ .Release.Namespace }} {{ template "newrelic.fullname" . }}

{{- if or (not .Values.ksm.enabled) (not .Values.kubelet.enabled) }}

###########
# WARNING #
###########

You have specified ksm or kubelet integration components as not enabled.
Those components are needed to have the full experience on NROne kubernetes explorer.

{{- end }}

{{- if .Values.nodeSelector }}

###########
# WARNING #
###########

You have specified "nodeSelector" into values, however the new version of the chart
support different nodeSelectors per each component, therefore the value specified has been ignored.

Please use ksm.nodeSelector, controlPlane.nodeSelector and kubelet.nodeSelector.

{{- end }}

{{- if .Values.nodeAffinity }}

###########
# WARNING #
###########

You have specified "nodeAffinity" into values, however the new version of the chart
support different nodeAffinity options per component, therefore the value specified has been ignored.

Please use ksm.affinity.nodeAffinity, controlPlane.affinity.nodeAffinity and kubelet.affinity.nodeAffinity.

{{- end }}

{{- if .Values.resources }}

###########
# WARNING #
###########

You have specified the "resources" into values, however the new version of the chart
support different resources per component, therefore the value specified has been ignored.

Please use ksm.resources, controlPlane.resources and kubelet.resources.

{{- end }}

{{- if .Values.tolerations }}

###########
# WARNING #
###########

You have specified "tolerations" into values, however the new version of the chart
support different tolerations per component, therefore the value specified has been ignored.

Please use ksm.tolerations, controlPlane.tolerations and kubelet.tolerations.

{{- end }}

{{- if ( or .Values.image ) }}

###########
# WARNING #
###########

You have specified into values options "image.*".
The following values are no longer supported and are currently ignored.
 - image.repository
 - image.tag
 - image.pullPolicy
 - image.pullSecrets:

Notice that the 3.x version of the integration uses 3 different images. One , one bundling
the agent and the different onHost integrations and one used merely to forward data to Newrelic.
Please set:
 - images.forwarder.* to configure the image in charge of sending data to newrelic backend
 - images.agent.* to configure the image bundling the agent and onHost integration
 - images.integration.* to configure the image in charge of scraping k8s data

{{- end }}

{{- if (or .Values.enableWindows .windowsOsList .windowsSecurityContext .windowsNodeSelector)}}

###########
# WARNING #
###########

Windows is currently supported by 2.x charts only.

{{- end }}

{{- if ( or .Values.etcdTlsSecretName .etcdTlsSecretNamespace )}}

###########
# WARNING #
###########

Values "etcdTlsSecretName" and "etcdTlsSecretNamespace" are no longer supported, please specify them in the config
file. Example:
# - endpoints:
#     - url: https://localhost:9979
#       insecureSkipVerify: true
#       auth:
#         type: mTLS
#         mtls:
#           secretName: secret-name
#           secretNamespace: secret-namespace

{{- end }}

{{- if .Values.logFile }}

###########
# WARNING #
###########

The "logFile" value is no longer supported, please specify the option "log_file" directly in "common.agentConfig".

{{- end }}

{{- if .Values.runAsUser }}

###########
# WARNING #
###########

The "runAsUser" value is no longer supported, please specify it with the value "securityContext.runAsUser".

{{- end }}

{{- if .Values.eventQueueDepth }}

###########
# WARNING #
###########

The "eventQueueDepth" value is no longer supported, please specify the option "event_queue_depth" directly in "common.agentConfig".

{{- end }}

{{- if .Values.apiServerSecurePort }}

###########
# WARNING #
###########

The "apiServerSecurePort" value is no longer supported, please if needed specify them in the new "apiServer.autodiscover[].endpoints".

{{- end }}

{{- if and (include "newrelic.fargate" .) .Values.kubelet.affinity.nodeAffinity }}

###########
# WARNING #
###########

You have specified both an EKS Fargate environment (global.fargate) and custom
nodeAffinity rules, so we couldn't automatically exclude the kubelet daemonSet from
Fargate nodes. In order for the integration to work, you MUST manually exclude
the daemonSet from Fargate nodes.

Please make sure your custom .Values.kubelet.affinity.nodeAffinity achieve the same effect as:

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: eks.amazonaws.com/compute-type
              operator: NotIn
              values:
                - fargate
{{- end }}
