{{- if .Values.controlPlane.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "newrelic.labels" . | nindent 4 }}
  name: {{ template "newrelic.fullname" . }}-control-plane
data:
  nri-kubernetes.yml: |-
    {{- .Values.common.config | toYaml | nindent 4 }}
    controlPlane:
      enabled: true

    {{- if  .Values.controlPlane.config.etcd.enabled }}
      etcd:
{{ include "newrelic.compatibility.control-plane" (dict "autodiscover" .Values.controlPlane.config.etcd.autodiscover "staticEndpoint" .Values.controlPlane.config.etcd.staticEndpoint "etcdEndpointUrl" .Values.etcdEndpointUrl ) | indent 8 }}
    {{- end -}}

    {{- if  .Values.controlPlane.config.scheduler.enabled }}
      scheduler:
{{ include "newrelic.compatibility.control-plane" (dict "autodiscover" .Values.controlPlane.config.scheduler.autodiscover "staticEndpoint" .Values.controlPlane.config.scheduler.staticEndpoint "etcdEndpointUrl" .Values.schedulerEndpointUrl ) | indent 8 }}
    {{- end -}}

    {{- if  .Values.controlPlane.config.controllerManager.enabled }}
      controllerManager:
{{ include "newrelic.compatibility.control-plane" (dict "autodiscover" .Values.controlPlane.config.controllerManager.autodiscover "staticEndpoint" .Values.controlPlane.config.controllerManager.staticEndpoint "etcdEndpointUrl" .Values.controllerManagerEndpointUrl ) | indent 8 }}
    {{- end -}}

    {{- if  .Values.controlPlane.config.apiServer.enabled }}
      apiServer:
{{ include "newrelic.compatibility.control-plane" (dict "autodiscover" .Values.controlPlane.config.apiServer.autodiscover "staticEndpoint" .Values.controlPlane.config.apiServer.staticEndpoint "etcdEndpointUrl" .Values.apiServerEndpointUrl ) | indent 8 }}
    {{- end -}}
{{- end -}}
