{{ if or .Values.integrations_config .Values.integrations }}
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "newrelic.labels" . | nindent 4 }}
  name: {{ template "newrelic.fullname" . }}-integrations-cfg
data:
{{/* TODO: Remove legacy integrations_config range */}}
{{- range .Values.integrations_config }}
  # Legacy integrations_config entry
{{ .name | indent 2 }}: |
    ---
{{ toYaml .data | indent  4 }}
{{- end }}

{{- range $k, $v := .Values.integrations }}
  {{ $k | trimSuffix ".yaml" | trimSuffix ".yml" }}.yaml: |
    {{- tpl ($v | toYaml) $ | nindent 4 }}
{{- end }}
{{- end }}
