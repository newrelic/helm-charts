---
discovery:
  command:
    exec: /var/db/newrelic-infra/nri-discovery-kubernetes
    match:
      label.name: vizier-cloud-connector
integrations:
  - name: nri-flex
    interval: 60s
    config:
      name: pixie-health-check
      apis:
        - event_type: pixieHealth
          commands:
            - run: curl --insecure -s https://${discovery.ip}:50800/healthz | xargs | awk '{print "cloud_connector_health:"$1}'
              split_by: ":"
          merge: pixieHealthCheck
        - event_type: pixieStatus
          commands:
            - run: curl --insecure -s https://${discovery.ip}:50800/statusz | awk '{if($1 == ""){ print "cloud_connector_status:OK" } else { print "cloud_connector_status:"$1 }}'
              split_by: ":"
          merge: pixieHealthCheck