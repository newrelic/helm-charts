kube-state-metrics:
  # kube-state-metrics.enabled -- Install the [`kube-state-metrics` chart](https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-state-metrics).
  enabled: true
  # -- Sets resources for kube-state-metrics.
  resources: {}
  # -- Disable prometheus from auto-discovering KSM and potentially scraping duplicated data
  prometheusScrape: false
  # -- Enable resource quota data exporting
  enableResourceQuotaSamples: false
  # kube-state-metrics.metricLabelsAllowlist -- Expose resource labels as metric dimensions.
  # @default -- `["pods=[*]", "namespaces=[*]", "deployments=[*]"]`
  metricLabelsAllowlist:
    - "pods=[*]"
    - "namespaces=[*]"
    - "deployments=[*]"
  # kube-state-metrics.metricAnnotationsAllowList -- Expose resource annotations as metric dimensions.
  # @default -- `["pods=[*]", "namespaces=[*]", "deployments=[*]"]`
  metricAnnotationsAllowList:
    - "pods=[*]"
    - "namespaces=[*]"
    - "deployments=[*]"

opentelemetry-kube-stack:
  # opentelemetry-kube-stack.enabled -- Enable the OpenTelemetry Kube Stack for managing CRDs and the OpenTelemetry Operator.
  enabled: true

  # -- Disable default daemon collector (this chart manages custom OpenTelemetryCollector CRs with New Relic-specific configurations)
  collectors:
    daemon:
      enabled: false

  # CRD installation settings
  crds:
    # -- Install OpenTelemetry CRDs: OpenTelemetryCollector, TargetAllocator, Instrumentation, and OpAMPBridge
    installOtel: true
    # -- Control Prometheus Operator CRDs installation (not required for New Relic integration)
    installPrometheus: false

  # OpenTelemetry Operator configuration for reconciling OpenTelemetryCollector custom resources
  opentelemetry-operator:
    enabled: true
    manager:
      collectorImage:
        repository: otel/opentelemetry-collector-k8s
        tag: "0.141.0"
    # Admission webhook configuration with Ignore policy to prevent installation race conditions.
    # Reference: https://github.com/open-telemetry/opentelemetry-helm-charts/issues/677
    admissionWebhooks:
      failurePolicy: "Ignore"
      certManager:
        enabled: false
      autoGenerateCert:
        enabled: true
    # CRD creation is disabled as CRDs are managed by the kube-stack's CRD subchart
    crds:
      create: false

  # Auto-instrumentation is disabled as it is not utilized by this New Relic integration
  instrumentation:
    enabled: false

  # Cluster role is disabled as RBAC resources are managed by this chart's templates
  clusterRole:
    enabled: false

# -- OpenTelemetry Target Allocator configuration for dynamic distribution of Prometheus scrape targets across collector instances.
# The Target Allocator enables horizontal scaling of metric collection by distributing scrape targets efficiently.
# Reference: https://github.com/open-telemetry/opentelemetry-operator/blob/main/cmd/otel-allocator/README.md
targetAllocator:
  # -- Target Allocator configuration for the StatefulSet collector to distribute cluster-wide scrape targets.
  statefulset:
    # -- Enable Target Allocator for the StatefulSet collector deployment.
    enabled: true
    # -- Target allocation strategy. Options: "least-weighted" (balances load) or "consistent-hashing" (sticky assignments).
    strategy: "least-weighted"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

  # -- Target Allocator configuration for the DaemonSet collector to distribute node-local scrape targets.
  daemonset:
    # -- Enable Target Allocator for the DaemonSet collector deployment. Typically disabled as DaemonSet pods naturally scrape node-local targets.
    enabled: true
    # -- Target allocation strategy. For DaemonSet deployments, "per-node" ensures each pod only scrapes targets on its node.
    strategy: "per-node"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

# -- DaemonSet collector configuration for node-local metrics including kubelet stats, cAdvisor, and host metrics.
daemonset:
  # -- Enable the DaemonSet collector deployment for collecting node-local metrics including kubelet stats, cAdvisor, and host metrics.
  enabled: true
  # -- Sets daemonset pod node selector. Overrides root-level `nodeSelector`
  nodeSelector: {}
  # -- Tolerations to allow scheduling on control-plane and master nodes.
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
    - key: node-role.kubernetes.io/master
      operator: Exists
      effect: NoSchedule
  # -- Sets daemonset pod affinities. Overrides root-level `affinity`
  affinity: {}
  # -- Annotations to be added to the daemonset pods.
  podAnnotations: {}
  # -- Sets security context (at pod level) for the daemonset. Overrides root-level `podSecurityContext`
  podSecurityContext: {}
  # -- Sets security context (at container level) for the daemonset. Overrides root-level `containerSecurityContext`
  containerSecurityContext:
    privileged: false
    runAsNonRoot: true
    runAsUser: 1001
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  # -- Sets resources for the daemonset.
  resources: {}
  # -- Sets additional environment variables for the daemonset.
  envs: []
  # -- Sets additional environment variable sources for the daemonset.
  envsFrom: []
  # -- Additional args for the daemonset container
  # https://opentelemetry.io/docs/collector/configuration/
  # Example:
  # extraArgs:
  #   - "--config=yaml:service::telemetry::logs::level: debug"
  #   - "--config=yaml:exporters::otlphttp/newrelic::endpoint: https://otlp.eu.nr-data.net"
  extraArgs: []
  # -- Settings for daemonset configmap
  # @default -- See `values.yaml`
  configMap:
    # -- OpenTelemetry config for the daemonset. If set, overrides default config and disables configuration parameters for the daemonset.
    overrideConfig: {}
    # -- Additional OpenTelemetry config for the daemonset. If set, extends the default config by adding more receivers/processors/exporters/connectors/pipelines.
    extraConfig:
      receivers: []
      processors: []
      exporters: []
      connectors: []
      pipelines: []
  # -- Additional volumes to be added to the daemonset pod
  extraVolumes: []
  # - name: example-volume
  #   configMap:
  #     name: example-configmap
  # -- Additional volume mounts to be added to the daemonset container
  extraVolumeMounts: []
  # - name: example-volume
  #   mountPath: /etc/example
  #   readOnly: true

# -- StatefulSet collector configuration for cluster-wide metrics including kube-state-metrics and control plane components.
# Note: This collector runs in StatefulSet mode.
statefulset:
  # -- Enable the StatefulSet collector deployment for collecting cluster-wide metrics.
  enabled: true
  # -- Sets statefulset pod node selector. Overrides root-level `nodeSelector`
  nodeSelector: {}
  # -- Tolerations for the statefulset pods.
  tolerations: []
  # -- Sets statefulset pod affinities. Overrides root-level `affinity`
  affinity: {}
  # -- Annotations to be added to the statefulset pods.
  podAnnotations: {}
  # -- Sets security context (at pod level) for the statefulset. Overrides root-level `podSecurityContext`
  podSecurityContext: {}
  # -- Sets security context (at container level) for the statefulset. Overrides root-level `containerSecurityContext`
  containerSecurityContext:
    privileged: false
    runAsNonRoot: true
    runAsUser: 1001
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  # -- Sets resources for the statefulset.
  resources: {}
  # -- Sets additional environment variables for the statefulset.
  envs: []
  # -- Sets additional environment variable sources for the statefulset.
  envsFrom: []
  # -- Additional args for the statefulset container
  # https://opentelemetry.io/docs/collector/configuration/
  # Example:
  # extraArgs:
  #   - "--config=yaml:service::telemetry::logs::level: debug"
  #   - "--config=yaml:exporters::otlphttp/newrelic::endpoint: https://otlp.eu.nr-data.net"
  extraArgs: []
  # -- Settings for statefulset configmap
  # @default -- See `values.yaml`
  configMap:
    # -- OpenTelemetry config for the statefulset. If set, overrides default config and disables configuration parameters for the statefulset.
    overrideConfig: {}
    # -- Additional OpenTelemetry config for the statefulset. If set, extends the default config by adding more receivers/processors/exporters/connectors/pipelines.
    extraConfig:
      receivers: []
      processors: []
      exporters: []
      connectors: []
      pipelines: []
  # -- Additional volumes to be added to the statefulset pod
  extraVolumes: []
  # - name: example-volume
  #   configMap:
  #     name: example-configmap
  # -- Additional volume mounts to be added to the statefulset container
  extraVolumeMounts: []
  # - name: example-volume
  #   mountPath: /etc/example
  #   readOnly: true

# -- Common configuration for both daemonset and statefulset collectors.
# nameOverride shortens resource names by replacing the chart name.
# Since the OpenTelemetry Operator adds "-collector" suffix to pod names,
# using "nr-k8s-otel" avoids duplication (instead of "nr-k8s-otel-collector-{ds|ss}-collector").
# Result: {release}-nr-k8s-otel-{ds|ss}-collector-{hash}
nameOverride: "nr-k8s-otel"
# -- Proxy configuration for collectors.
proxy: ""
# -- Feature gates for OpenTelemetry Collector.
featureGates: ""

# -- Define custom processors here. See: https://opentelemetry.io/docs/collector/configuration/#processors
# @default -- Empty (use built-in processors configured in helpers)
processors: {}

# -- Define custom exporters here. See: https://opentelemetry.io/docs/collector/configuration/#exporters
# @default -- Empty (use built-in exporters configured in helpers)
exporters: {}

# -- Configure the New Relic metrics pipeline processing behavior.
# Allows insertion of custom processors and exporters at pipeline ingress (before New Relic processing) and egress (after New Relic processing).
metricsPipeline:
  # -- Ingress configuration: processors and exporters applied before New Relic metric transformation.
  collectorIngress:
    # -- Additional processors to apply to raw metrics at the beginning of the pipeline, before New Relic processors.
    processors: []
    # -- Additional exporters for raw metrics before New Relic processing.
    exporters: []
  # -- Egress configuration: processors and exporters applied after New Relic metric transformation.
  collectorEgress:
    # -- Additional processors to apply after New Relic metrics processors have transformed the data.
    processors: []
    # -- Additional exporters for processed metrics after New Relic transformation.
    exporters: []

# -- Configure the New Relic logs pipeline processing behavior.
# Allows insertion of custom processors and exporters at pipeline ingress (before New Relic processing) and egress (after New Relic processing).
logsPipeline:
  # -- Ingress configuration: processors and exporters applied before New Relic log transformation.
  collectorIngress:
    # -- Additional processors to apply to raw logs at the beginning of the pipeline, before New Relic processors.
    processors: []
    # -- Additional exporters for raw logs before New Relic processing.
    exporters: []
  # -- Egress configuration: processors and exporters applied after New Relic log transformation.
  collectorEgress:
    # -- Additional processors to apply after New Relic logs processors have transformed the data.
    processors: []
    # -- Additional exporters for processed logs after New Relic transformation.
    exporters: []

receivers:
  prometheus:
    # -- Enable the Prometheus receiver for scraping metrics from Kubernetes components and kube-state-metrics.
    # @default -- `true`
    enabled: true
    # @default -- `1m`
    scrapeInterval: 1m
    # @default -- `app.kubernetes.io/name=kube-state-metrics`
    ksmSelector: "app.kubernetes.io/name=kube-state-metrics"
  k8sEvents:
    # -- Enable the Kubernetes events receiver for capturing cluster events.
    # @default -- `true`
    enabled: true
  hostmetrics:
    # -- Enable the host metrics receiver for collecting node-level system metrics.
    # @default -- `true`
    enabled: true
    # @default -- `1m`
    scrapeInterval: 1m
  kubeletstats:
    # -- Enable the kubelet stats receiver for collecting container and pod metrics from the kubelet API.
    # @default -- `true`
    enabled: true
    # @default -- `1m`
    scrapeInterval: 1m
  filelog:
    # -- Enable the file log receiver for collecting container logs from node file systems.
    # @default -- `true`
    enabled: true
  collectorMetrics:
    # -- Enable collection of OpenTelemetry Collector self-monitoring metrics.
    # @default -- `false`
    enabled: false
    # @default -- `1m`
    scrapeInterval: 1m

# -- Images used by the chart.
images:
  pullSecrets: []
  # -- Image for the OpenTelemetry Collector.
  collector:
    registry: ""
    repository: newrelic/nrdot-collector-k8s
    tag: "1.5.0"
    pullPolicy: IfNotPresent
  # -- Image for the initContainer that retrieves node allocatable resources.
  kubectl:
    registry: ""
    repository: bitnami/kubectl
    tag: latest
    pullPolicy: IfNotPresent

# -- The cluster name for the Kubernetes cluster.
cluster: ""

# -- The license key for your New Relic Account. This will be preferred configuration option if both `licenseKey` and `customSecret` are specified.
licenseKey: ""

# -- Name of the Secret object where the license key is stored
customSecretName: ""

# -- Key in the Secret object where the license key is stored
customSecretLicenseKey: ""

# -- The provider that hosts your cluster. Can be one of "GKE_AUTOPILOT" or "OPEN_SHIFT"
provider: ""

# -- Additional labels for chart objects
labels: {}

# -- Additional labels for chart pods
podLabels: {}

# -- Sets pod's priorityClassName
priorityClassName: ""

# -- Sets pod's dnsConfig
dnsConfig: {}

# -- Sets pod's affinity. Can be configured also with `daemonset.affinity` or `statefulset.affinity`
affinity: {}

# -- Sets pod's nodeSelector. Can be configured also with `daemonset.nodeSelector` or `statefulset.nodeSelector`
nodeSelector: {}

# -- Sets pod's tolerations. Can be configured also with `daemonset.tolerations` or `statefulset.tolerations`
tolerations: []

# -- Sets pod's security context at pod level
podSecurityContext: {}

# -- Sets pod's security context at container level
containerSecurityContext: {}

# -- Image pull secrets
imagePullSecrets: []

# -- Sets RBAC mode
rbac:
  # -- Enable RBAC
  enabled: true

# -- Sets service account
serviceAccount:
  # -- Enable service account
  enabled: true
  # -- Name of the service account
  name: ""
  # -- Annotations for the service account
  annotations: {}

# -- (bool) Sets the debug logs to this integration or all integrations if it is set globally.
# @default -- `false`
# Setting to true will cause collector to crash, known upstream bug https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/44705
verboseLog: false

# -- (bool) Send the metrics to the staging backend. Requires a valid staging license key.
# @default -- `false`
nrStaging: false

# -- (bool) Send only the [metrics required](https://github.com/newrelic/helm-charts/tree/master/charts/nr-k8s-otel-collector/docs/metrics-lowDataMode.md) to light up the NR kubernetes UI
# @default -- `true`
lowDataMode: true