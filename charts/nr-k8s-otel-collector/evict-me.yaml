---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: low-priority
value: -1 # A negative value ensures it is lower than the default of 0
description: "This priority class is for pods that are first to be evicted."
---
apiVersion: v1
kind: Pod
metadata:
  name: target-for-eviction
spec:
  priorityClassName: low-priority # Assign the low-priority class
  containers:
    - name: sleeper
      image: busybox
      command: ["/bin/sh", "-c"]
      args: ["sleep 3600"]
  restartPolicy: Never

---
apiVersion: v1
kind: Pod
metadata:
  name: memory-eater
spec:
  priorityClassName: low-priority # Assign the low-priority class
  # Assign to a specific node to guarantee it runs where you intend to cause pressure
  containers:
    - name: stress
      image: polinux/stress-ng
      command: ["/bin/sh", "-c"]
      args: ["stress-ng --vm-bytes 4G --vm-keep --vm 1 --timeout 300s"]
      resources:
        # Set low requests and high limits to ensure the pod can burst and cause resource pressure
        requests:
          memory: "10Mi"
        limits:
          memory: "3Gi"
  # Important: Set a lower Quality of Service (QoS) class
  # By not setting requests and limits to be equal, the pod is "Burstable,"
  # making it more susceptible to eviction.
  restartPolicy: Never
