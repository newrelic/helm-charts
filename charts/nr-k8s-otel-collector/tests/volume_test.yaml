suite: volume
templates:
  - templates/deployment.yaml
  - templates/daemonset.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: doesn't set additional volumes or volume mounts by default
set:
  cluster: my-cluster
  licenseKey: us-whatever
asserts:
  - notExists:
  path: spec.volumes
template: templates/deployment.yaml
  - notExists:
  path: spec.volumeMounts
template: templates/deployment.yaml
  - equal:
  path: spec.volumes
  value:
- hostPath:
path: /
  name: hostfs
- hostPath:
path: /var/log/pods
  name: varlogpods
template: templates/daemonset.yaml
  - equal:
  path: spec.volumeMounts
  value:
- mountPath: /hostfs
  name: hostfs
  readOnly: true
- mountPath: /var/log/pods
  name: varlogpods
  readOnly: true
template: templates/daemonset.yaml
  - it: adds additional deployment volumes and volume mounts when set
set:
  cluster: my-cluster
  licenseKey: us-whatever
  deployment:
extraVolumes:
  - name: extra-deployment-volume
emptyDir: { }
extraVolumeMounts:
  - name: extra-deployment-volume
mountPath: /extra/deployment/path
asserts:
  - equal:
  path: spec.volumes
  value:
- name: extra-deployment-volume
  emptyDir: { }
template: templates/deployment.yaml
  - equal:
  path: spec.volumeMounts
  value:
- name: extra-deployment-volume
  mountPath: /extra/deployment/path
template: templates/deployment.yaml
  - it: adds additional daemonset volumes and volume mounts when set
set:
  cluster: my-cluster
  licenseKey: us-whatever
  daemonset:
extraVolumes:
  - name: extra-daemonset-volume
emptyDir: { }
extraVolumeMounts:
  - name: extra-daemonset-volume
mountPath: /extra/daemonset/path
asserts:
  - equal:
  path: spec.volumes
  value:
- hostPath:
path: /
  name: hostfs
- hostPath:
path: /var/log/pods
  name: varlogpods
- emptyDir: { }
  name: extra-daemonset-volume
template: templates/daemonset.yaml
  - equal:
  path: spec.volumeMounts
  value:
- mountPath: /hostfs
  name: hostfs
  readOnly: true
- mountPath: /var/log/pods
  name: varlogpods
  readOnly: true
- mountPath: /extra/daemonset/path
  name: extra-daemonset-volume
template: templates/daemonset.yaml