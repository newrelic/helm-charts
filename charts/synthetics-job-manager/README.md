# synthetics-job-manager

## Chart Details

This chart will deploy the New Relic Synthetics Containerized Private Job Manager alongside the runtimes that execute synthetics checks.

## Configuration

| Parameter                                 | Description                                                                                                                                                                                                                                                                                                                                                          | Default                                                                                                                                                              |
|-------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `synthetics.privateLocationKey`           | *Required if synthetics.privateLocationKeySecretName not set* - The [authentication key](https://docs.newrelic.com/docs/synthetics/synthetic-monitoring/private-locations/install-containerized-private-minions-cpms#private-location-key) associated with your Synthetics Private Location                                                                          |                                                                                                                                                                      |
| `synthetics.privateLocationKeySecretName` | *Required if synthetics.privateLocationKey not set* - Name of the Kubernetes Secret that contains a key called `privateLocationKey` with the [authentication key](https://docs.newrelic.com/docs/synthetics/synthetic-monitoring/private-locations/install-containerized-private-minions-cpms#private-location-key) associated with your Synthetics Private Location |                                                                                                                                                                      |
| `global.internalApiKey`                   | *Required if global.internalApiKeySecretName is not set* - This key restrictions communication between synthetics-job-manager and the various runtimes and can be any value you want.                                                                                                                                                                                |                                                                                                                                                                      |
| `global.internalApiKeySecretName`         | *Required if global.internalApiKey is not set* - Name of the Kubernetes Secret that contains a key called `internalApiKey`. This key restricts communication between synthetics-job-manager and the various runtimes and can be any value you want.                                                                                                                  |                                                                                                                                                                      |
| `global.hostnameOverride`                 | Overrides the default hostname used for the synthetics-job-manager Service.                                                                                                                                                                                                                                                                                          | `synthetics-job-manager`                                                                                                                                             |
| `global.checkTimeout`                     | The maximum number of seconds that your monitor checks are allowed to run. This value must be an integer between `0 seconds (exclusive)` and `900 seconds (inclusive)` (for example, from 1 second to 15 minutes).                                                                                                                                                   | `180` seconds for browser monitors, script_browser monitors, and script_api monitors.                                                                                           |
| `global.ping-runtime.hostnameOverride`    | Overrides the default hostname used for the ping-runtime Service.                                                                                                                                                                                                                                                                                                    | `ping`                                                                                                                                                               |
| `replicaCount`                            | Number of synthetics-job-manager replicas to maintain                                                                                                                                                                                                                                                                                                                | `1`                                                                                                                                                                  |
| `imagePullSecrets`                        | The name of a Secret object used to pull an image from a specified container registry                                                                                                                                                                                                                                                                                |                                                                                                                                                                      |
| `nameOverride`                            | The nameOverride replaces the name of the chart in the Chart.yaml file.                                                                                                                                                                                                                                                                                              |                                                                                                                                                                      |
| `fullnameOverride`                        | Name override used for your installation in place of the default                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                      |
| `appVersionOverride`                      | Release version of synthetics-job-manager to use in place of the version specified in [Chart.yaml](Chart.yaml)                                                                                                                                                                                                                                                       |                                                                                                                                                                      |
| `synthetics.logLevel`                     | Modify, to boot synthetics-job-manager with a specified log level. (`ALL`, `DEBUG`, `INFO`, `WARN`, `ERROR`, `FATAL`, `OFF`, `TRACE`)                                                                                                                                                                                                                                | `INFO`                                                                                                                                                               |
| `synthetics.hordeApiEndpoint `            | Ensure synthetics-job-manager can connect to the appropriate endpoint in order to serve your monitor.                                                                                                                                                                                                                                                                | For US-based accounts, the endpoint is: `https://synthetics-horde.nr-data.net`. For EU-based accounts, the endpoint is: `https://synthetics-horde.eu01.nr-data.net/` |
| `synthetics.vsePassphrase`                | *(Not yet supported)* If set, enables verified script execution and uses this value as a passphrase.                                                                                                                                                                                                                                                                 |                                                                                                                                                                      |
| `synthetics.vsePassphraseSecretName `     | *(Not yet supported)* If set, enables verified script execution and uses this value to retrieve the passphrase from a Kubernetes secret with a key called `vsePassphrase`.                                                                                                                                                                                           |                                                                                                                                                                      |
| `synthetics.apiProxyHost`                 | Proxy used to allow synthetics-job-manager to communicate with New Relic to fetch and report Synthetics checks. *Required if synthetics.apiProxyPort is set*                                                                                                                                                                                                         |                                                                                                                                                                      |
| `synthetics.apiProxyPort`                 | Proxy used to allow synthetics-job-manager to communicate with New Relic to fetch and report Synthetics checks. *Required if synthetics.apiProxyHost is set*                                                                                                                                                                                                         |                                                                                                                                                                      |
| `synthetics.hordeApiProxySelfSignedCert`  | If `synthetics.hordeApiProxy` is present and uses a self signed cert, enable this value. Acceptable values: true, 1, or yes (any case).                                                                                                                                                                                                                              |                                                                                                                                                                      |
| `synthetics.hordeApiProxyUsername`        | If `synthetics.hordeApiProxy` is present and any authentication is needed, set this value to the credentials username - Support HTTP Basic Auth + additional authentication protocols supported by Chrome.                                                                                                                                                           |                                                                                                                                                                      |
| `synthetics.hordeApiProxyPw`              | If `synthetics.hordeApiProxy` is present and any authentication is needed, set this value to the credentials password - Support HTTP Basic Auth + additional authentication protocols supported by Chrome.                                                                                                                                                           |                                                                                                                                                                      |
| `synthetics.userDefinedEnvVariable`       | *(Not yet supported)* A locally hosted set of user defined key value pairs. See [example](https://docs.newrelic.com/docs/synthetics/synthetic-monitoring/private-locations/containerized-private-minion-cpm-configuration#vars-scripted-monitors)                                                                                                                    |                                                                                                                                                                      |
| `synthetics.jvmOpts`                      | *(Not yet supported)* Passes command line options to the internal JVM.                                                                                                                                                                                                                                                                                               | `-XX:+UseAdaptiveSizePolicy -XX:MaxGCPauseMillis=100 -XX:GCTimeRatio=3`                                                                                              |
| `synthetics.networkHealthCheckDisabled`   | *(Not yet supported)* The Network Healthcheck disabled state, to manage the synthetics-job-manager check for public internet access. Set as 'true' to bypass this health check.                                                                                                                                                                                      | `false`                                                                                                                                                              |
| `image.repository`                        | The container to pull.                                                                                                                                                                                                                                                                                                                                               | `newrelic/synthetics-job-manager`                                                                                                                                    |
| `image.pullPolicy`                        | The pull policy.                                                                                                                                                                                                                                                                                                                                                     | `IfNotPresent`                                                                                                                                                       |
| `appArmorProfileName`                     | *(Not yet supported)* Name of an AppArmor profile to load.                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                      |
| `resources`                               | Resource requests and limits.                                                                                                                                                                                                                                                                                                                                        | See the [Resources](#Resources) section below                                                                                                                        |
| `podAnnotations`                          | Annotations to be added to the synthetics-job-manager pod                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                      |
| `podSecurityContext`                      | Custom security context for the synthetics-job-manager pod                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                      |
| `securityContext`                         | Custom security context for the synthetics-job-manager containers                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                      |
| `labels`                                  | labels to be added to all synthetics-job-manager resources                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                      |
| `annotations`                             | Annotations to be added to the synthetics-job-manager pod                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                      |
| `nodeSelector`                            | Node labels for synthetics-job-manager pod assignment                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                      |
| `tolerations`                             | Node taints to tolerate for synthetics-job-manager                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                      |
| `affinity`                                | Pod affinity for synthetics-job-manager                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                      |
| `ping-runtime.enabled`                    | Whether or not the persistent ping runtime deployment and service should be enabled.                                                                                                                                                                                                                                                                                 | `true`                                                                                                                                                               |
| `node-api-runtime.enabled`                | Whether or not the node api runtime deployment should be enabled.                                                                                                                                                                                                                                                                                                    | `true`                                                                                                                                                               |
| `node-browser-runtime.enabled`            | Whether or not the browser runtime deployment and service should be enabled.                                                                                                                                                                                                                                                                                         | `true`                                                                                                                                                               |


### Ping Runtime Configuration

| Parameter                                   | Description                                                                                          | Default                            |
|---------------------------------------------|------------------------------------------------------------------------------------------------------|------------------------------------|
| `ping-runtime.replicaCount`                 | Number of ping-runtime replicas to maintain                                                          | `1`                                |
| `ping-runtime.imagePullSecrets`             | The name of a Secret object used to pull an image from a specified container registry                |                                    |
| `ping-runtime.nameOverride`                 | The nameOverride replaces the name of the chart in the Chart.yaml file.                              |                                    |
| `ping-runtime.fullnameOverride`             | Name override used for your installation in place of the default                                     |                                    |
| `ping-runtime.appVersionOverride`           | Release version of ping-runtime to use in place of the version specified in [Chart.yaml](Chart.yaml) |                                    |
| `ping-runtime.image.repository`             | The container to pull.                                                                               | `newrelic/synthetics-ping-runtime` |
| `ping-runtime.image.pullPolicy`             | The pull policy.                                                                                     | `IfNotPresent`                     |
| `ping-runtime.appArmorProfileName`          | *(Not yet supported)* Name of an AppArmor profile to load.                                           |                                    |
| `ping-runtime.resources`                    | Resource requests and limits.                                  | See the [Resources](#Resources) section below                                                 |                                        |
| `ping-runtime.podAnnotations`               | Annotations to be added to the ping-runtime pod                                                      |                                    |
| `ping-runtime.podSecurityContext`           | Custom security context for the ping-runtime pod                                                     |                                    |
| `ping-runtime.securityContext`              | Custom security context for the ping-runtime containers                                              |                                    |
| `ping-runtime.labels`                       | labels to be added to all ping-runtime resources                                                     |                                    |
| `ping-runtime.annotations`                  | Annotations to be added to the ping-runtime pod                                                      |                                    |
| `ping-runtime.nodeSelector`                 | Node labels for ping-runtime pod assignment                                                          |                                    |
| `ping-runtime.tolerations`                  | Node taints to tolerate for ping-runtime                                                             |                                    |
| `ping-runtime.affinity`                     | Pod affinity for ping-runtime                                                                        |                                    |


### Node API Runtime Configuration

| Parameter                              | Description                                                                                                            | Default                                |
|----------------------------------------|------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
| `node-api-runtime.parallelism`         | Number of node-api-runtime jobs to execute in parallel                                                                 | `1`                                    |
| `node-api-runtime.completions`         | Number of node-api-runtime jobs that you expect to execute per minute (multiplied by the value of `parallelism` above) | `6`                                    |
| `node-api-runtime.imagePullSecrets`    | The name of a Secret object used to pull an image from a specified container registry                                  |                                        |
| `node-api-runtime.nameOverride`        | The nameOverride replaces the name of the chart in the Chart.yaml file.                                                |                                        |
| `node-api-runtime.fullnameOverride`    | Name override used for your installation in place of the default                                                       |                                        |
| `node-api-runtime.appVersionOverride`  | Release version of node-api-runtime to use in place of the version specified in [Chart.yaml](Chart.yaml)               |                                        |
| `node-api-runtime.image.repository`    | The container to pull.                                                                                                 | `newrelic/synthetics-node-api-runtime` |
| `node-api-runtime.image.pullPolicy`    | The pull policy.                                                                                                       | `IfNotPresent`                         |
| `node-api-runtime.appArmorProfileName` | *(Not yet supported)* Name of an AppArmor profile to load.                                                             |                                        |
| `node-api-runtime.resources`           | Resource requests and limits.             | See the [Resources](#Resources) section below                                                                                                                        |                                                                              |                                        |
| `node-api-runtime.podAnnotations`      | Annotations to be added to the node-api-runtime pod                                                                    |                                        |
| `node-api-runtime.podSecurityContext`  | Custom security context for the node-api-runtime pod                                                                   |                                        |
| `node-api-runtime.securityContext`     | Custom security context for the node-api-runtime containers                                                            |                                        |
| `node-api-runtime.labels`              | labels to be added to all node-api-runtime resources                                                                   |                                        |
| `node-api-runtime.annotations`         | Annotations to be added to the node-api-runtime pod                                                                    |                                        |
| `node-api-runtime.nodeSelector`        | Node labels for node-api-runtime pod assignment                                                                        |                                        |
| `node-api-runtime.tolerations`         | Node taints to tolerate for node-api-runtime                                                                           |                                        |
| `node-api-runtime.affinity`            | Pod affinity for node-api-runtime                                                                                      |                                        |


### Node Browser Runtime Configuration

| Parameter                                  | Description                                                                                                                | Default                                    |
|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
| `node-browser-runtime.parallelism`         | Number of node-browser-runtime jobs to execute in parallel                                                                 | `1`                                        |
| `node-browser-runtime.completions`         | Number of node-browser-runtime jobs that you expect to execute per minute (multiplied by the value of `parallelism` above) | `6`                                        |
| `node-browser-runtime.imagePullSecrets`    | The name of a Secret object used to pull an image from a specified container registry                                      |                                            |
| `node-browser-runtime.nameOverride`        | The nameOverride replaces the name of the chart in the Chart.yaml file.                                                    |                                            |
| `node-browser-runtime.fullnameOverride`    | Name override used for your installation in place of the default                                                           |                                            |
| `node-browser-runtime.appVersionOverride`  | Release version of node-browser-runtime to use in place of the version specified in [Chart.yaml](Chart.yaml)               |                                            |
| `node-browser-runtime.image.repository`    | The container to pull.                                                                                                     | `newrelic/synthetics-node-browser-runtime` |
| `node-browser-runtime.image.pullPolicy`    | The pull policy.                                                                                                           | `IfNotPresent`                             |
| `node-browser-runtime.appArmorProfileName` | *(Not yet supported)* Name of an AppArmor profile to load.                                                                 |                                            |
| `node-browser-runtime.resources`           | Resource requests and limits.                          | See the [Resources](#Resources) section below                                                                                                                        |                                                                     |                                            |
| `node-browser-runtime.podAnnotations`      | Annotations to be added to the node-browser-runtime pod                                                                    |                                            |
| `node-browser-runtime.podSecurityContext`  | Custom security context for the node-browser-runtime pod                                                                   |                                            |
| `node-browser-runtime.securityContext`     | Custom security context for the node-browser-runtime containers                                                            |                                            |
| `node-browser-runtime.labels`              | labels to be added to all node-browser-runtime resources                                                                   |                                            |
| `node-browser-runtime.annotations`         | Annotations to be added to the node-browser-runtime pod                                                                    |                                            |
| `node-browser-runtime.nodeSelector`        | Node labels for node-browser-runtime pod assignment                                                                        |                                            |
| `node-browser-runtime.tolerations`         | Node taints to tolerate for node-browser-runtime                                                                           |                                            |
| `node-browser-runtime.affinity`            | Pod affinity for node-browser-runtime                                                                                      |                                            |


## Example

Make sure you have [added the New Relic chart repository.](../../README.md#installing-charts)

Then, to install this chart, run the following command:

```sh
helm install newrelic/synthetics-job-manager \
--set synthetics.privateLocationKey=<enter_synthetics_private_location_key> \
```

To install the runtime charts make sure to pass in the `values.yaml` for both synthetics-job-manager and runtime charts. For instance, to install the node-api-runtime the command is as follows:

```sh
helm install [chart-name] charts/synthetics-job-manager/charts/node-api-runtime \
--values charts/synthetics-job-manager/values.yaml \
--values charts/synthetics-job-manager/charts/node-api-runtime/values.yaml \
```

## Resources

The default set of resources assigned to **synthetics-job-manager** is shown below:

```yaml
resources:
  requests:
    cpu: 0.5
    memory: 800Mi
  limits:
    cpu: 0.75
    memory: 1.6Gi
```
The default set of resources assigned to **ping runtime** is shown below:

```yaml
resources:
  requests:
    cpu: 0.5
    memory: 500Mi
  limits:
    cpu: 0.75
    memory: 1.0Gi
```
The default set of resources assignmed to the **node-api runtime** is shown below: 
```yaml
resources:
  requests:
    cpu: 0.5
    memory: 1250Mi
  limits:
    cpu: 0.75
    memory: 2500Mi
```
The default set of resources assignmed to the **node-browser runtime** is shown below: 
```yaml
resources:
  requests:
    cpu: 0.5
    memory: 2000Mi
  limits:
    cpu: 0.75
    memory: 3000Mi
```
