suite: helm release values templating
templates:
  - templates/helm-release.yaml
release:
  name: my-release
  namespace: my-namespace
tests:
  - it: by default has no values
    asserts:
      - notExists:
          path: .spec.values
      - notExists:
          path: .spec.valuesFrom

  - it: values are set correctly
    set:
      helm:
        release:
          values:
            key: value
            key2: value2
    asserts:
      - equal:
          path: .spec.values
          value:
            key: value
            key2: value2

  - it: valuesFrom are set correctly
    set:
      helm:
        release:
          valuesFrom:
            key: value
            key2: value2
    asserts:
      - equal:
          path: .spec.valuesFrom
          value:
            key: value
            key2: value2

  - it: values and valuesFrom can be set at the same time
    set:
      helm:
        release:
          values:
            key: value
            key2: value2
          valuesFrom:
            fromKey: value
            fromKey2: value2
    asserts:
      - equal:
          path: .spec.values
          value:
            key: value
            key2: value2
      - equal:
          path: .spec.valuesFrom
          value:
            fromKey: value
            fromKey2: value2
