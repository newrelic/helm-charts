suite: Validate installation job setup
tests:
  - it: do not include agent-control-cd permissions if disabled
    set:
      agentControlCd:
        enabled: false
    asserts:
      - template: rbac-cd.yaml
        hasDocuments:
          count: 0
      - template: ac-flux-deployment-secret.yaml
        hasDocuments:
          count: 0
      - template: installation-job.yaml
        notMatchRegex:
          path: spec.template.spec.containers[0].args[0]
          pattern: "helm upgrade --install"
      - template: uninstallation-job.yaml
        notMatchRegex:
          path: spec.template.spec.containers[0].args[0]
          pattern: "helm uninstall"
