suite: Validate Flux2 sourceController configuration
tests:
  - it: agent-control-cd.flux2.sourceController.create disabled should trigger an error
    set:
      agent-control-deployment:
        cluster: cluster
        licenseKey: some_license_key
        identityClientId: some_client_id
        identityClientSecret: some_client_secret
        config:
          fleet_control:
            auth:
              organizationId: some_org_id
      agent-control-cd:
        flux2:
          enabled: true
          sourceController:
            create: false
    asserts:
      - failedTemplate:
          errorMessage: sourceController.create cannot be disabled when flux is enabled

  - it: agent-control-cd.flux2.helmController.create disabled should trigger an error
    set:
      agent-control-deployment:
        cluster: cluster
        licenseKey: some_license_key
        identityClientId: some_client_id
        identityClientSecret: some_client_secret
        config:
          fleet_control:
            auth:
              organizationId: some_org_id
      agent-control-cd:
        flux2:
          enabled: true
          helmController:
            create: false
    asserts:
      - failedTemplate:
          errorMessage: helmController.create cannot be disabled when flux is enabled

