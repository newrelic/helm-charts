suite: Validate Secret Override Logic
chart:
  appVersion: 0.0.0

tests:
  - it: should set cdRemoteUpdate as false when agentControlCd is disabled
    set:
      agentControlDeployment:
        chartValues:
          cdRemoteUpdate: true
      agentControlCd:
        enabled: false
    asserts:
      - template: templates/ac-deployment-secret.yaml
        matchRegex:
          decodeBase64: true
          path: data["agent-control-deployment.yaml"]
          pattern: "cdRemoteUpdate: false"

  - it: should set true for cdRemoteUpdate when agentControlCd is enabled and the value is set
    set:
      agentControlDeployment:
        chartValues:
          cdRemoteUpdate: true
      agentControlCd:
        enabled: false
    asserts:
      - template: templates/ac-deployment-secret.yaml
        matchRegex:
          decodeBase64: true
          path: data["agent-control-deployment.yaml"]
          pattern: "cdRemoteUpdate: false"

  - it: should set false for cdRemoteUpdate when agentControlCd is enabled and the value is set
    set:
      agentControlDeployment:
        chartValues:
          cdRemoteUpdate: false
      agentControlCd:
        enabled: true
    asserts:
      - template: templates/ac-deployment-secret.yaml
        matchRegex:
          decodeBase64: true
          path: data["agent-control-deployment.yaml"]
          pattern: "cdRemoteUpdate: false"

  - it: should set no value for cdRemoteUpdate when agentControlCd is enabled and the value is unset
    set:
      agentControlCd:
        enabled: true
    asserts:
      - template: templates/ac-deployment-secret.yaml
        notMatchRegex:
          decodeBase64: true
          path: data["agent-control-deployment.yaml"]
          pattern: "cdRemoteUpdate"
