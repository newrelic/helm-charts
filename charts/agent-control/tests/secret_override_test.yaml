suite: Validate Secret Override Logic
chart:
  appVersion: 0.0.0

tests:
  - it: should encode cdRemoteUpdate as false when flux2 is disabled
    set:
      agent-control-deployment:
        enabled: true
        cdRemoteUpdate: true
      agent-control-cd:
        flux2:
          enabled: false
    asserts:
      - template: templates/ac-deployment-secret.yaml
        equal:
          path: data["override.yaml"]
          value: YWdlbnQtY29udHJvbC1kZXBsb3ltZW50OgogIGNkUmVtb3RlVXBkYXRlOiBmYWxzZQ==

  - it: should encode the user's value for cdRemoteUpdate when flux2 is enabled
    set:
      agent-control-deployment:
        enabled: true
        cdRemoteUpdate: true
      agent-control-cd:
        flux2:
          enabled: true
    asserts:
      - template: templates/ac-deployment-secret.yaml
        equal:
          path: data["override.yaml"]
          value: YWdlbnQtY29udHJvbC1kZXBsb3ltZW50OgogIGNkUmVtb3RlVXBkYXRlOiB0cnVl